

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running kernels on the GPU &mdash; Plures v0.2.0dev3 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://xnd.io/xndtools/tutorials/gpu_kernel.html"/>
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Releases" href="../../releases/index.html" />
    <link rel="prev" title="Generating new kernels for gumath" href="getting_started.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/xndlogo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v0.2.0dev3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../libxnd/index.html">libxnd</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../xnd/index.html">xnd</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../libgumath/index.html">libgumath</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gumath/index.html">gumath</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">xndtools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#kernel-generator">kernel_generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#notes">Notes</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#tutorials">Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="getting_started.html">Generating new kernels for gumath</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Running kernels on the GPU</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Releases</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Plures</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">xndtools</a> &raquo;</li>
        
      <li>Running kernels on the GPU</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="running-kernels-on-the-gpu">
<h1>Running kernels on the GPU<a class="headerlink" href="#running-kernels-on-the-gpu" title="Permalink to this headline">¶</a></h1>
<p>We will see how we can run kernels on the GPU. The following is a typical CUDA
code which adds the elements of two arrays of a given size:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// file: add_gpu.cu</span>

<span class="cp">#include</span> <span class="cpf">&quot;gpu.h&quot;</span><span class="cp"></span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">stride</span> <span class="o">=</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">gridDim</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">stride</span><span class="p">)</span>
        <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">add_gpu</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">blockSize</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">numBlocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">blockSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">blockSize</span><span class="p">;</span>
    <span class="n">add</span><span class="o">&lt;&lt;&lt;</span><span class="n">numBlocks</span><span class="p">,</span> <span class="n">blockSize</span><span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="n">cudaDeviceSynchronize</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">add</span></code> function is called a CUDA kernel (not to be confused with the
<code class="docutils literal notranslate"><span class="pre">gumath</span></code> kernels!). This is what will actually run on the GPU. The reason why
a GPU is faster than a CPU is because it can massively parallelize
computations, and this is why we have these <code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">stride</span></code> variables:
the kernel will be applied on different parts of the data at the same time.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">gumath</span></code> kernel however will use the <code class="docutils literal notranslate"><span class="pre">add_gpu</span></code> function, which
internally calls <code class="docutils literal notranslate"><span class="pre">add</span></code> with a special CUDA syntax and some extra-parameters
(basically specifying how much it will be parallelized). The
<code class="docutils literal notranslate"><span class="pre">cudaDeviceSynchronize()</span></code> function call blocks the CPU execution until all
GPU computations are done.</p>
<p>The GPU has its own memory, which is different from the CPU memory. When we
want to do a computation on the GPU, we first have to copy the data from the
CPU side to the GPU side, and when we want to retrieve the results from the
GPU, we have to copy its data back to the CPU. This can be taken care of by the
so called “unified memory”, which provides a single memory space accessible by
the GPU and the CPU. The following file contains functions to allocate memory
in the unified memory and to delete it, here again through special CUDA
functions:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// file: gpu.cu</span>

<span class="cp">#include</span> <span class="cpf">&quot;gpu.h&quot;</span><span class="cp"></span>

<span class="kt">float</span><span class="o">*</span> <span class="nf">get_array</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">cudaMallocManaged</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">del_array</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">cudaFree</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now let’s see how the <code class="docutils literal notranslate"><span class="pre">gpu.h</span></code> file looks like:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// file: gpu.h</span>

<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">void</span> <span class="n">add_gpu</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">r</span><span class="p">);</span>
<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">float</span><span class="o">*</span> <span class="n">get_array</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">void</span> <span class="n">del_array</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">x</span><span class="p">);</span>
</pre></div>
</div>
<p>It consists of the prototypes of the <code class="docutils literal notranslate"><span class="pre">add_gpu</span></code> function for which we want to
make a kernel, and the <code class="docutils literal notranslate"><span class="pre">get_array</span></code> and <code class="docutils literal notranslate"><span class="pre">del_array</span></code> functions which we will
use to manage the memory for our data. Note the <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code> declaration:
because <code class="docutils literal notranslate"><span class="pre">nvcc</span></code> (the CUDA compiler) is a C++ compiler, we need to expose them
as C functions to Python.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">gpu.cu</span></code> only manages the GPU memory, and is independent of the
<code class="docutils literal notranslate"><span class="pre">gumath</span></code> kernel generation, we will simply access its functions through a
shared library.  This is how we compile it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ nvcc -o libgpu.so --compiler-options <span class="s2">&quot;-fPIC&quot;</span> --shared gpu.cu
</pre></div>
</div>
<p>This gives us a <code class="docutils literal notranslate"><span class="pre">libgpu.so</span></code> library that we can interface with in Python using
<code class="docutils literal notranslate"><span class="pre">ctypes</span></code>. The following code wraps the C functions to Python functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: gpu.py</span>

<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">xnd</span> <span class="kn">import</span> <span class="n">xnd</span>

<span class="n">gpu</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s1">&#39;./libgpu.so&#39;</span><span class="p">)</span>
<span class="n">gpu</span><span class="o">.</span><span class="n">get_array</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">)</span>
<span class="n">gpu</span><span class="o">.</span><span class="n">del_array</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span><span class="p">),</span> <span class="p">]</span>

<span class="k">def</span> <span class="nf">xnd_gpu</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ctypeslib</span><span class="o">.</span><span class="n">as_array</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">xnd</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">addr</span>

<span class="k">def</span> <span class="nf">del_gpu</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
    <span class="n">gpu</span><span class="o">.</span><span class="n">del_array</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">xnd_gpu</span></code> returns an XND container (and its data pointer) whose data live in
the unified memory, and <code class="docutils literal notranslate"><span class="pre">del_gpu</span></code> frees the memory referenced by a pointer.</p>
<p>Now we need to generate the <code class="docutils literal notranslate"><span class="pre">gumath</span></code> kernel for our <code class="docutils literal notranslate"><span class="pre">add_gpu</span></code> function. We
save its prototype in the following file:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// file: add_gpu.h</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="nf">add_gpu</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">r</span><span class="p">);</span>
</pre></div>
</div>
<p>The corresponding configuration file looks like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># file: add_gpu-kernels.cfg

[MODULE add_gpu]
typemaps =
     float: float32
     int: int32
includes =
     add_gpu.h
include_dirs =
sources =
     add_gpu.c

libraries =

library_dirs =

header_code =
kinds = C
ellipses = none

[KERNEL add_gpu]
prototypes =
     void add_gpu(int   n, float *  x, float *  y, float *  r);
description =
dimension = x(n), y(n), r(n)
input_arguments = x, y
inplace_arguments = r
hide_arguments = n = len(x)
</pre></div>
</div>
<p>We can now generate the kernel:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ xnd_tools kernel add_gpu-kernels.cfg
$ xnd_tools module add_gpu-kernels.cfg
</pre></div>
</div>
<p>And create a static library:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ nvcc --compiler-options <span class="s1">&#39;-fPIC&#39;</span> -c add_gpu.cu
$ gcc -fPIC                                               <span class="se">\</span>
  -c add_gpu-kernels.c                                    <span class="se">\</span>
  -c <span class="nv">$SITE_PACKAGES</span>/xndtools/kernel_generator/xndtools.c  <span class="se">\</span>
  -I<span class="nv">$SITE_PACKAGES</span>/xndtools/kernel_generator              <span class="se">\</span>
  -I<span class="nv">$SITE_PACKAGES</span>/xnd                                    <span class="se">\</span>
  -I<span class="nv">$SITE_PACKAGES</span>/ndtypes                                <span class="se">\</span>
  -I<span class="nv">$SITE_PACKAGES</span>/gumath
$ ar rcs libadd_gpu-kernels.a add_gpu.o add_gpu-kernels.o xndtools.o
</pre></div>
</div>
<p>Finally, launch <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code> with this <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># file: setup.py</span>

<span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="nn">distutils.sysconfig</span> <span class="kn">import</span> <span class="n">get_python_lib</span>

<span class="n">site_packages</span> <span class="o">=</span> <span class="n">get_python_lib</span><span class="p">()</span>
<span class="n">lib_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s1">&#39;{site_packages}/{i}&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ndtypes&#39;</span><span class="p">,</span> <span class="s1">&#39;gumath&#39;</span><span class="p">,</span> <span class="s1">&#39;xnd&#39;</span><span class="p">]]</span>

<span class="n">module1</span> <span class="o">=</span> <span class="n">Extension</span><span class="p">(</span><span class="s1">&#39;add_gpu&#39;</span><span class="p">,</span>
                    <span class="n">include_dirs</span> <span class="o">=</span> <span class="n">lib_dirs</span><span class="p">,</span>
                    <span class="n">libraries</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;add_gpu-kernels&#39;</span><span class="p">,</span> <span class="s1">&#39;ndtypes&#39;</span><span class="p">,</span><span class="s1">&#39;gumath&#39;</span><span class="p">,</span> <span class="s1">&#39;xnd&#39;</span><span class="p">,</span> <span class="s1">&#39;cudart&#39;</span><span class="p">,</span> <span class="s1">&#39;stdc++&#39;</span><span class="p">],</span>
                    <span class="n">library_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;/usr/local/cuda-9.2/lib64&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lib_dirs</span><span class="p">,</span>
                    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;add_gpu-python.c&#39;</span><span class="p">])</span>

<span class="n">setup</span> <span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;add_gpu&#39;</span><span class="p">,</span>
       <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
       <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;This is a gumath kernel extension that adds two XND containers on the GPU&#39;</span><span class="p">,</span>
       <span class="n">ext_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">module1</span><span class="p">])</span>
</pre></div>
</div>
<p>If everything went fine, you should be able to run the kernel on the GPU:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gpu</span> <span class="k">import</span> <span class="n">xnd_gpu</span><span class="p">,</span> <span class="n">del_gpu</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">add_gpu</span> <span class="k">import</span> <span class="n">add_gpu</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">size</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span><span class="p">,</span> <span class="n">a0</span> <span class="o">=</span> <span class="n">xnd_gpu</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x1</span><span class="p">,</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">xnd_gpu</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">xnd_gpu</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="gp">... </span>    <span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span>
<span class="go">xnd([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, ...], type=&#39;1048576 * float32&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x1</span>
<span class="go">xnd([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, ...], type=&#39;1048576 * float32&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_gpu</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span>
<span class="go">xnd([1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, ...], type=&#39;1048576 * float32&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">del_gpu</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">del_gpu</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">del_gpu</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../releases/index.html" class="btn btn-neutral float-right" title="Releases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getting_started.html" class="btn btn-neutral float-left" title="Generating new kernels for gumath" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Plures Project
      <span class="lastupdated">
        Last updated on True.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>